<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<link rel="stylesheet" type="text/css"
	th:href="@{/webjars/bootstrap/3.3.7/css/bootstrap.min.css}" />
<link rel="stylesheet" type="text/css" th:href="@{/css/main.css}" />
<meta charset="utf-8" />
<link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" />
<link rel="stylesheet"
	href="https://fonts.googleapis.com/css?family=Lato" />
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script
	src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<link rel="stylesheet"
	href="https://cdn.datatables.net/1.10.12/css/jquery.dataTables.min.css" />
<script
	src="https://cdn.datatables.net/1.10.12/js/jquery.dataTables.min.js"></script>
<script src="https://unpkg.com/gijgo@1.9.13/js/gijgo.min.js"
	type="text/javascript"></script>
<script
	src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.0.0/dist/tf.min.js"></script>
<script
	src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-vis@1.0.2/dist/tfjs-vis.umd.min.js"></script>
<script
	src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>
<!--     <script src="js/redneuronal.js"></script> -->
<link href="https://unpkg.com/gijgo@1.9.13/css/gijgo.min.css"
	rel="stylesheet" type="text/css" />
<!-- 	<script src="/js/datatable.js"></script> -->
<title>Sistema Adaptativo Predictivo</title>
<style>
.slidecontainer {
	width: 100%;
}

.slider {
	-webkit-appearance: none;
	width: 100%;
	height: 25px;
	background: #d3d3d3;
	outline: none;
	opacity: 0.7;
	-webkit-transition: .2s;
	transition: opacity .2s;
}

.slider:hover {
	opacity: 1;
}

.slider::-webkit-slider-thumb {
	-webkit-appearance: none;
	appearance: none;
	width: 25px;
	height: 25px;
	background: #4CAF50;
	cursor: pointer;
}

.slider::-moz-range-thumb {
	width: 25px;
	height: 25px;
	background: #4CAF50;
	cursor: pointer;
}

.loader {
  position: absolute;
  left: 50%;
  top: 50%;
  z-index: 1;
  width: 150px;
  height: 150px;
  margin: -75px 0 0 -75px;
  border: 16px solid #f3f3f3;
  border-radius: 50%;
  border-top: 16px solid blue;
  border-right: 16px solid green;
  border-bottom: 16px solid red;
  width: 120px;
  height: 120px;
  -webkit-animation: spin 2s linear infinite;
  animation: spin 2s linear infinite;
}

.loader2 {
  position: absolute;
  left: 43%;
  top: 60%;
}

/* Safari */
@-webkit-keyframes spin {
  0% { -webkit-transform: rotate(0deg); }
  100% { -webkit-transform: rotate(360deg); }
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.animate-bottom {
  position: relative;
  -webkit-animation-name: animatebottom;
  -webkit-animation-duration: 1s;
  animation-name: animatebottom;
  animation-duration: 1s
}

@-webkit-keyframes animatebottom {
  from { bottom:-100px; opacity:0 } 
  to { bottom:0px; opacity:1 }
}

@keyframes animatebottom { 
  from{ bottom:-100px; opacity:0 } 
  to{ bottom:0; opacity:1 }
}

#myDiv {
  display: none;
  text-align: center;
}
</style>
</head>
<body>


	<div class="container" id="myDiv" >
		<div class="row">
			<nav class="navbar navbar-default">
			  <div class="container-fluid">
			    <!-- Brand and toggle get grouped for better mobile display -->
			    <div class="navbar-header">
			      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
			        <span class="sr-only">Toggle navigation</span>
			        <span class="icon-bar"></span>
			        <span class="icon-bar"></span>
			        <span class="icon-bar"></span>
			      </button>
			      <a class="navbar-brand" href="/viewAdmin">Sistema Adaptativo Predictivo</a>
			    </div>
			
			    <!-- Collect the nav links, forms, and other content for toggling -->
			    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
			      <ul class="nav navbar-nav">
			        <li><a href="/mantProf">Mant. Profesores<span class="sr-only">(current)</span></a></li>
			        <li class="active"><a href="#">Mant. Alumnos<span class="sr-only">(current)</span></a></li>
			        <li><a href="/mantAulSec">Mant. Aulas y Secciones<span class="sr-only">(current)</span></a></li>
			        <li><a href="/mantComp">Mant. Competencias<span class="sr-only">(current)</span></a></li>
			      </ul>
			      <ul class="nav navbar-nav navbar-right">
			        <li class="dropdown">
			          <a href="/logout" class="btn btn-default">Cerrar Sesión</a>
			        </li>
			      </ul>
			    </div><!-- /.navbar-collapse -->
			  </div><!-- /.container-fluid -->
			</nav>
			<div class="col-md-10 col-md-offset-1">
				<div class="panel panel-default">
					<div class="panel-body">
						<div class="text-center">
							<h3>
								<div th:if="${session.containsKey('persona')}" th:text="${'Bienvenido: '+session.persona.name}"></div>
							</h3>
							<h3>
								<i class="glyphicon glyphicon-cog" style="font-size: 2em;"></i>
							</h3>
							<h2 class="text-center">Mantenimiento de Alumnos</h2>
							<table id="alumnoTable" style="display:none;" class="display table-responsive table">

									<!-- Header Table -->
									<thead>
										<tr>
											<th>Id</th>
											<th>Documento</th>
											<th>Nombre</th>
											<th>Email</th>
											<th>Telefono</th>
											<th>Editar</th>
										</tr>
									</thead>
									<!-- Footer Table -->
									<tfoot>
										<tr>
											<th>Id</th>
											<th>Documento</th>
											<th>Nombre</th>
											<th>Email</th>
											<th>Telefono</th>
											<th>Editar</th>
										</tr>
									</tfoot>
								</table>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	
	<div id="mdAlumno" class="modal fade" role="dialog">
		<div class="modal-dialog">

			<!-- Modal content-->
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal">&times;</button>
					<h4 class="modal-title">Actualizar Alumno</h4>
				</div>
				<div class="modal-body">
					<div th:fragment="alumno-form" id="alumno-form">
						<form id="alumnoInfo" th:action="@{/alumnoDTO/guardar}" th:object="${alumno}" method="post">

                                <p class="error-message"
                                   th:if="${#fields.hasGlobalErrors()}"
                                   th:each="error : ${#fields.errors('global')}"
                                   th:text="${error}">Validation error</p>

								<input type="hidden" id="id" th:field="*{id}"></input>
                                <div class="form-group"
                                     th:classappend="${#fields.hasErrors('name')}? 'has-error':''">
                                    <div class="input-group">
                                        <span class="input-group-addon">
                                            <i class="glyphicon glyphicon-user color-blue"></i>
                                        </span>
                                        <input id="lastName"
                                               class="form-control"
                                               placeholder="Nombres y Apellidos"
                                               th:field="*{name}"></input>
                                    </div>
                                    <p class="error-message"
                                       th:each="error: ${#fields.errors('name')}"
                                       th:text="${error}">Validation error</p>
                                </div>
                                <div class="form-group"
                                     th:classappend="${#fields.hasErrors('telefono')}? 'has-error':''">
                                    <div class="input-group">
                                        <span class="input-group-addon">
                                            <i class="glyphicon glyphicon-phone color-blue"></i>
                                        </span>
                                        <input id="telefono"
                                               class="form-control"
                                               placeholder="Telefono"
                                               th:field="*{telefono}"></input>
                                    </div>
                                    <p class="error-message"
                                       th:each="error: ${#fields.errors('telefono')}"
                                       th:text="${error}">Validation error</p>
                                </div>
                                <div class="form-group"
                                     th:classappend="${#fields.hasErrors('documento')}? 'has-error':''">
                                    <div class="input-group">
                                        <span class="input-group-addon">
                                            <i class="glyphicon glyphicon-paperclip color-blue"></i>
                                        </span>
                                        <input id="documento"
                                               class="form-control"
                                               placeholder="Documento"
                                               th:field="*{documento}"></input>
                                    </div>
                                    <p class="error-message"
                                       th:each="error: ${#fields.errors('documento')}"
                                       th:text="${error}">Validation error</p>
                                </div>
                                <div class="form-group"
                                     th:classappend="${#fields.hasErrors('direccion')}? 'has-error':''">
                                    <div class="input-group">
                                        <span class="input-group-addon">
                                            <i class="glyphicon glyphicon-paperclip color-blue"></i>
                                        </span>
                                        <input id="direccion"
                                               class="form-control"
                                               placeholder="Dirección"
                                               th:field="*{direccion}"></input>
                                    </div>
                                    <p class="error-message"
                                       th:each="error: ${#fields.errors('direccion')}"
                                       th:text="${error}">Validation error</p>
                                </div>
                                <div class="form-group">
                                    <button type="submit" class="btn btn-success btn-block">Actualizar</button>
                                </div>
                            </form>
					</div>
					
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
				</div>
			</div>

		</div>
	</div>

	<script th:inline="javascript">
	/*<![CDATA[*/
		// 		var urlsys = 'http://34.195.249.193';
		var urlsys = 'http://localhost:8080';
		
		var frmClear = "";
	    $(document).ready( function () {
			document.getElementById("myDiv").style.display = "block";
			buscar();
			frmClear = $("#alumno-form").html()+"";
			var $form = $('#alumnoInfo');
		     $form.on('submit', function(e) {
		       e.preventDefault();
		       $.ajax({
		         url: $form.attr('action'),
		         type: 'post',
		         data: $form.serialize(),
		         success: function(response) {
		           // if the response contains any errors, replace the form
		           if ($(response).find('.has-error').length) {
// 		             $form.replaceWith(response);
		             $("#alumno-form").html(response);
		             $form = $('#alumnoInfo');
		             beSubmit($form);
		           } else {
		        	   window.location.href='mantAlumno?success';
		           }
		         }
		     });
	   		});
	   });
	
	    function beSubmit($form){
	    	$form.on('submit', function(e) {
			       e.preventDefault();
			       $.ajax({
			         url: $form.attr('action'),
			         type: 'post',
			         data: $form.serialize(),
			         success: function(response) {
			           // if the response contains any errors, replace the form
			           if ($(response).find('.has-error').length) {
//	 		             $form.replaceWith(response);
			             $("#alumno-form").html(response);
			             $form = $('#alumnoInfo');
			             beSubmit($form);
			           } else {
			        	   window.location.href='mantAlumno?success';
			           }
			         }
			     });
		   		});
	    }
	
	     function editar(id) {
	    	 $.ajax({
		    		url: urlsys+'/alumno/getAlumno/'+id,
		    		type:"GET",
		    		success: function(respuesta) {
		    			$("#alumno-form").html(frmClear);
		    			$form = $('#alumnoInfo');
			             beSubmit($form);
		    			console.log(respuesta);
		    			$('#id').val(respuesta.id);
		    			$('#lastName').val(respuesta.nombre);
		    	    	$('#telefono').val(respuesta.telefono);
		    	    	$('#documento').val(respuesta.documento);
		    	    	$('#direccion').val(respuesta.direccion);
			    		$('#mdAlumno').modal('show');
		    		},
		    		error: function() {
		    	        console.log("No se ha podido obtener la información");
		    	    }
		    	});
	     }
	
	    function buscar() {
			var table = $('#alumnoTable')
					.DataTable(
							{
								"sAjaxSource" : "/alumno/listAlumnos",
								"sAjaxDataProp" : "",
								"order" : [ [ 0, "asc" ] ],
								"paging" : false,
								"bDestroy" : true,
								"aoColumns" : [
										{
											"mData" : "id"
										},
										{
											"mData" : "persona.documento"
										},
										{
											"mData" : "persona.name"
										},
										{
											"mData" : "persona.email"
										},
										{
											"mData" : "persona.telefono"
										},
										{
											"mRender" : function(data, type,
													full) {
													return '<a href="#" onclick="editar('
															+ full.persona.id
															+ ')" class="btn btn-primary btn-table">Editar</a>';

											}
										} ],
								"language" : {
									"lengthMenu" : "Mostrar _MENU_ filas por página",
									"zeroRecords" : "Ninguna fila",
									"info" : "Mostrando página _PAGE_ de _PAGES_",
									"infoEmpty" : "Ninguna fila disponible",
									"infoFiltered" : "(Filtrado de _MAX_ total filas)",
									"search" : "Buscar:"
								}

							})
			document.getElementById("alumnoTable").style.display = "block";
		}
	    
	    	/*]]>*/
    </script>

</body>
</html>